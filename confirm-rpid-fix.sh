#!/bin/bash

echo "âœ… FIDO App Updated with rpId Fix"
echo "=================================="
echo ""
echo "ğŸ”§ Changes made:"
echo "   âœ… Added FIDO_RELYING_PARTY environment variable"
echo "   âœ… Updated NativeAuthService to process challengeData"
echo "   âœ… Added base64 decode/encode logic for challengeData"
echo "   âœ… Replace rpId with configured relying party (anhngo.site)"
echo ""
echo "ğŸ“¦ Image details:"
echo "   âœ… Repository: ngoduyanh/fido-app"
echo "   âœ… Tag: latest"
echo "   âœ… Platforms: linux/amd64, linux/arm64"
echo "   âœ… Docker Hub URL: https://hub.docker.com/r/ngoduyanh/fido-app"
echo ""
echo "ğŸ”§ How it works:"
echo "   1. WSO2 IS returns challengeData with rpId from its configuration"
echo "   2. FIDO app decodes the base64 challengeData"
echo "   3. Replaces rpId with our configured relying party (anhngo.site)"
echo "   4. Encodes back to base64 and returns to client"
echo "   5. Client receives challengeData with correct rpId"
echo ""
echo "ğŸ¯ Expected behavior:"
echo "   âœ… No more 'different relying party' errors"
echo "   âœ… FIDO authentication works with correct rpId"
echo "   âœ… ChallengeData contains anhngo.site as rpId"
echo ""
echo "ğŸš€ To run updated FIDO app:"
echo "   docker-compose -f docker-compose-fido-only.yml up -d"
echo ""
echo "ğŸ“ Logs to check:"
echo "   - 'Original challengeData: ...' - shows original rpId from WSO2"
echo "   - 'Replaced rpId with: anhngo.site' - confirms replacement"
echo "   - 'Updated challengeData: ...' - shows final result"
echo ""
echo "âœ… FIDO app updated with rpId fix and pushed successfully!"


