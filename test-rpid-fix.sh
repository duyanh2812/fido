#!/bin/bash

echo "ğŸ”§ Testing rpId Fix for WebAuthn Authentication"
echo "=============================================="
echo ""
echo "ğŸ“‹ Problem identified:"
echo "   âŒ rpId was 'localhost' causing WebAuthn security error"
echo "   âœ… Fixed FIDO2TrustedOrigins in identity.xml to use nip.io domains"
echo ""
echo "ğŸ”§ Changes made:"
echo "   - Updated FIDO2TrustedOrigins in identity.xml"
echo "   - Removed localhost origins"
echo "   - Added nip.io domains: fido.18.143.154.126.nip.io, wso2.18.143.154.126.nip.io"
echo "   - Rebuilt WSO2 IS image with updated configuration"
echo ""
echo "ğŸš€ To test the rpId fix:"
echo "   1. Pull latest images:"
echo "      docker-compose pull"
echo ""
echo "   2. Restart services:"
echo "      docker-compose up -d"
echo ""
echo "   3. Test FIDO authentication:"
echo "      - Access: https://fido.18.143.154.126.nip.io"
echo "      - Try FIDO registration/authentication"
echo "      - Should no longer get 'rpId not a registrable domain' error"
echo ""
echo "ğŸ” Expected behavior:"
echo "   âœ… rpId should be 'fido.18.143.154.126.nip.io' instead of 'localhost'"
echo "   âœ… WebAuthn authentication should work without security errors"
echo "   âœ… No more 'relying party ID is not a registrable domain suffix' error"
echo "   âœ… FIDO2 authentication should work smoothly"
echo ""
echo "ğŸ“¦ Updated Images:"
echo "   - WSO2 IS: ngoduyanh/wso2is-custom-permission-fixed:latest"
echo "   - FIDO App: ngoduyanh/fido-app:latest"
echo ""
echo "ğŸ¯ This fix addresses:"
echo "   âœ… WebAuthn rpId domain validation"
echo "   âœ… FIDO2 trusted origins configuration"
echo "   âœ… Security error resolution"
echo ""
echo "ğŸ‰ Ready for testing with corrected rpId configuration!"